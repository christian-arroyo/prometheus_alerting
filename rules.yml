# groups:
# - name: example
#   rules:
#   # Alert for any cluster that has average CPU idle < 50%
#   - alert: HighUsage
#     expr: avg(irate(node_cpu_seconds_total{mode="idle"}[1m]) * 100) < 50
#     for: 1m
#     annotations:
#       summary: "High usage on {{ $labels.instance }}"
#       description: "{{ $labels.instance }} has a average CPU idle (current value: {{ $value }}s)"

groups:
- name: example
  rules:
  - alert: HostHighCpuLoad
    expr: (sum by (instance) (avg by (mode, instance) (rate(node_cpu_seconds_total{mode!="idle"}[2m]))) > 0.8) * on(instance) group_left (nodename) node_uname_info{nodename=~".+"}
    for: 10m
    labels:
      severity: warning
    annotations:
      summary: Host high CPU load (instance {{ $labels.instance }})
      description: "CPU load is > 80%\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"
  
  - alert: CriticalCPULoad
    expr: 100 — (avg by(instance) (irate(node_cpu_seconds_total{job=”node_exporter”,mode=”idle”}[5m])) * 100) > 10
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: “Host high CPU load (instance {{ $labels.instance }})”
      description: “The CPU load reported from {{ $labels.instance }} has exceeded 80% for more than 2 minutes.”

  # Alert for any cluster that has average CPU idle < 50%
  - alert: HighUsage
    expr: avg(irate(node_cpu_seconds_total{mode="idle"}[1m]) * 100) < 50
    for: 1m
    annotations:
      summary: "High usage on {{ $labels.instance }}"
      description: "{{ $labels.instance }} has a average CPU idle (current value: {{ $value }}s)"